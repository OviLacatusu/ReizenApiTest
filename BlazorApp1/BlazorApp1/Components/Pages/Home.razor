@using BlazorApp1.Components.Account
@using BlazorApp1.Data
@using Microsoft.AspNetCore.Authentication

@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Identity
@using Models

@page "/"

@inject UserManager<ApplicationUser> UserManager
@inject IHttpContextAccessor _context;
@inject AuthenticationStateProvider _auth

<PageTitle>Home </PageTitle>

<h1>Hello, world! </h1>
Welcome to your new app.
<AuthorizeView > 
    @if (context.User?.Identity?.IsAuthenticated == true)  
    { 
        @if(AccessToken != null)
        {
            <p>Access token: @AccessToken </p>
        }
    }
</AuthorizeView> 

@code{
    private string AccessToken { get; set; }

    private async Task GetAccessToken() 
    { 
        var current = await UserManager.GetUserAsync(_context.HttpContext.User);
        var token = await UserManager.GetAuthenticationTokenAsync(current, "GoogleOpenIdConnect", "access_token");
    }
    protected override async Task OnInitializedAsync() 
    {
        if(_context.HttpContext?.User?.Identity?.IsAuthenticated == true)
            await GetAccessToken();
    }
}